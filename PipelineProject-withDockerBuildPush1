pipeline {
    environment {
    registry = "sanmanivannan/jenkins-test"
    registryCredential = 'dockerhub-id'
  }
        agent any 
        stages {
            stage ('Packaging'){
                steps { 
                sh 'mvn clean package'
                      } 
            }
            stage ('Building Docker Image'){
                steps {
                sh "docker build . -t webapp.${env.BUILD_ID}"
            } 
            stage('Test') {
                steps {
        sh 'npm test'
      }
            }
            stage ('Pushing Docker Image to DockerHub'){
                steps {
                withCredentials([string(credentialsId: 'mytoken', variable: 'TOKEN')])    
                sh "docker build . -t webapp.${env.BUILD_ID}"
            } 
            }
        }
}

